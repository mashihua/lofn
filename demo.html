<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title></title>
	<style type="text/css">
		pre {
			font-family: Consolas,Courier New,NSimSun,SimSun,monospace;
			font-size: 12px;
		}
		#info {
			color: #009;
		}
		#output {
			font-weight: bolder;
			font-size: 14px;
		}
		#err {
			font-weight: bolder;
			color: red;
			font-size: 14px;
		}
		h1 {
			font-family: Arial,NSimSun,sans-serif;
		}
		#input {
			width: 99%;
			display: block;
			height: 16em;
		}
	</style>
</head>
<body>
	<textarea id="input"></textarea>
	<button id="go">Start script</button>
	<pre id="output"></pre>
	<pre id="err"></pre>
	<pre id="info"><noscript>The Lofn cannot be enabled because the JavaScript is disabled.</noscript></pre>

	<script type="text/javascript">
			//<![CDATA[
		var G_TRACE = function (element) {
			var _output = document.getElementById(element);
			function trace(x) {
				var s = '';
				for (var i = 0; i < arguments.length; i++) s += arguments[i];
				_output.appendChild(document.createTextNode(s));
				return arguments[arguments.length - 1];
			};
			function tracel() {
				var v = trace.apply(this, arguments);
				trace('\n');
				return v;
			};
			return {
				trace: trace,
				tracel: tracel,
				clrscr: clrscr
			}
		}
		var clrscr = function () {
			document.getElementById('output').innerHTML = document.getElementById('info').innerHTML = document.getElementById('err').innerHTML = '';
		}
//]]></script>

	<script src="primitives.js" type="text/javascript"></script>
	<script src="token.js" type="text/javascript"></script>
	<script src="parse.js" type="text/javascript"></script>
	<script src="compiler.js" type="text/javascript"></script>
	<script src="stl.js" type="text/javascript"></script>

	<script type="text/javascript">
		clrscr(), G_TRACE('info').tracel('The Lofn compiler.\n- Version hoejuu -\n\nBy Belleve Invis (aka. infinte)\n\nAmor ex Dessis.\n(From Dess with love)');
		document.getElementById('go').onclick = function () {
			clrscr();
			var tracel = G_TRACE('info').tracel;
			var tracex = G_TRACE('err').tracel;
			// start VM
			try {
				var script = new lofn.Script(document.getElementById('input').value);
				script.expose('alert', alert);
				script.expose('exports', {});
				script.asyncCompile(function(cm){
					tracel('Generated code:\n' + (' |\t' + cm.generatedSource).replace(/\n/g, '\n |\t'));
					script.start();
					tracel('--- DONE  ---');					
				}, function(t,i,b){tracel('done function #'+i+' (@'+t.id+')')});
			} catch (e) {
				tracex('! An error occurs \n\n' + e);
			}
		};
	</script>

</body>
</html>
